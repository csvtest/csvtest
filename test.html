<html>
    <head>
	    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
            <!-- Mappa -->
	    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
	    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
            <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" />
            <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"></script>
            <style id="jsbin-css">#map { height: 600px; border:solid;}</style>
       	    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
	    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
	    <script src="leaflet.ajax.min.js"></script>
	    
	    
    </head>
    <body>
	<div class="container-fluid">
		<div class="row">
			<div class="col-lg-6">
				<div id='map'></div>
			</div>
			<div class="col-lg-6">
				<div class="information">
				</div>
				<div id="chartContainer">
					<canvas id="redditiChart" width="400" height="400"></canvas>
					<script>
						var map = L.map('map', {
						    maxZoom: 18,
						    minZoom: 12,
						    maxBoundsViscosity: 10000.0
						});
						map.setView([44.4915, 11.3355], 12);
						var osm = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
						    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
						}).addTo(map);
						// var zone = new L.GeoJSON.AJAX("geojson_folder/ZoneBologna.geojson");
						var limiti = map.getBounds();
						map.setMaxBounds(limiti);

						$.ajax({
						    dataType: "json",
						    url: "geojson_folder/ZoneBologna.geojson",
						    success: function(data) {
							L.geoJson(data, {
							    onEachFeature: onEachFeature
							}).addTo(map);
						    }
						}).error(function() {});

						function onEachFeature(feature, layer) {
						    layer.bindPopup(feature.properties.Nome_zona);
						    layer.on('click', function(e) {
							$.ajax({
							    dataType: "json",
							    url: "geojson_folder/Reddito_2009-2016_per_zone.json",
							    success: function(dati) {
								dati.forEach(function(arrayItem) {
								    if (arrayItem["Zona"] == feature.properties.Nome_zona) {
									$('.information').html('');
									$('.information').html(arrayItem["Zona"]);
									var listRedditi = [];
									listRedditi.push(arrayItem["Reddito pro-capite 2009"]);
									listRedditi.push(arrayItem["Reddito pro-capite 2010"]);
									listRedditi.push(arrayItem["Reddito pro-capite 2011"]);
									listRedditi.push(arrayItem["Reddito pro-capite 2012"]);
									listRedditi.push(arrayItem["Reddito pro-capite 2013"]);
									listRedditi.push(arrayItem["Reddito pro-capite 2014"]);
									listRedditi.push(arrayItem["Reddito pro-capite 2015"]);
									listRedditi.push(arrayItem["Reddito pro-capite 2016"]);
									var listIndex = [];
									listIndex.push(arrayItem["Reddito pro-capite 2009"]);
									listIndex.push(arrayItem["Reddito pro-capite 2010"]);
									listIndex.push(arrayItem["Reddito pro-capite 2011"]);
									listIndex.push(arrayItem["Reddito pro-capite 2012"]);
									listIndex.push(arrayItem["Reddito pro-capite 2013"]);
									listIndex.push(arrayItem["Reddito pro-capite 2014"]);
									listIndex.push(arrayItem["Reddito pro-capite 2015"]);
									listIndex.push((arrayItem["Reddito pro-capite 2016"] * 1.092));
									$('#redditiChart').remove();
									$('#chartContainer').append('<canvas id="redditiChart"><canvas>');
									new Chart(document.getElementById("redditiChart"), {
									    "type": "line",
									    "data": {
										"labels": ["2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016"],
										"datasets": [
										   {	"label": "Index FOI",
											"data": listIndex,
											"type": "line",
											"fill": false,
											"borderColor": "rgb(255, 0, 0)",
										    	"spanGaps": true
										    },
										    {
											"label": "Line Dataset",
											"data": listRedditi,
											"type": "line",
											"fill": false,
											"borderColor": "rgb(54, 162, 235)"
										    }
										]
									    },
									    "options": {
										"scales": {
										    "yAxes": [{
											"ticks": {
											    "beginAtZero": false,
											    "scaleStartValue": 19000
											}
										    }]
										}
									    }
									});
								    }
								})

							    }
							}).error(function() {});
						    });
						};
					</script>
				</div>
			</div>
		</div>
	</div>
    </body> 
</html>
